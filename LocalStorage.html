<html>
 <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LocalStorage</title>
    <link rel="stylesheet" href="styles/jquery-mobile.css">
    <script type="text/javascript" src="scripts/libs/jquery.js"></script>
    <script type="text/javascript" src="scripts/libs/jquery.mobile-1.3.2.js"></script>
    <script data-main="scripts/main" src="scripts/libs/require.js"></script>
 </head>
 
 <body>
　　<div data-role="page" id="localStorage" data-title ="ビンゴカードID入力">
     <script type="text/javascript">
    
      $(function(){
        //ページを開いたら自動で現在のIDと内容を確認する
        load();
      });

      if (typeof localStorage == 'undefined') {
        document.write("<p>お使いのブラウザではWeb Storageが使えません。</p>");
      }
      else {
        //セッションストレージ設定
        var storage = localStorage;
      }

     function setlocalStorage() {
        var key1 = document.getElementById("textkey1").value;
     　  var key2 = document.getElementById("textkey2").value;
        var string = document.getElementById("textdata").value;
        
       
        if(key1 == "" && key2 != ""){
          Createobj(key2,string);
        }
        else if(key1 != "" && key2 == ""){
          Createobj(key1,string);
        }
        else{
          if(parseInt(key1)>parseInt(key2)){
            var tmp = key1;
            key1 = key2;
            key2 = tmp;
          }
          for(var i=parseInt(key1); i<=parseInt(key2); i++){
            console.log("hoi");
            Createobj(String(i),string);
          }
        }
        viewStorage();
    }

    function Createobj(key,string){
          var stringData = string.split(',');
          var intData = [
                      [0,0,0,0,0,key],
                      [0,0,0,0,0,0],
                      [0,0,0,0,0,0],
                      [0,0,0,0,0,0],
                      [0,0,0,0,0,0],
          ];
          card = new Object();
          var l = 0;
          for(var j=0; j<5; j++){
            for(var k=0; k<5; k++){
              if(j==2 && k==2){}
              else{
                intData[j][k] = parseInt(stringData[l]);
                l++;
              }
            }
          }
          PushlocalStrg(intData);
    }

    function PushlocalStrg(intData){
        var key = intData[0][5];
          //valueをJSONへ変換
        var json_value = JSON.stringify(intData);
        storage.setItem(key, json_value);
        alert("ID"+key+"番のカードを登録しました。");
    }

    function removeStorage() {
      var key = document.getElementById("deltextkey").value;
      storage.removeItem(key);
      key = "";
      alert("ID"+key+"番のカードを削除しました。")
      viewStorage();
    }

    function removeallStorage() {
      storage.clear();
      viewStorage();
    }


  
	function viewStorage(){
		$('#list').empty();
		for(var i = 0; i < storage.length; ){
			$('#list').append('<tr>');
			for(var j = 0; j < 10/* ←列数 */ && i < storage.length; i++, j++){
				var _key = storage.key(i);
				$('#list:last').append('<td style="width:40px; text-align:right;">' + _key + '</td>');
			}
			$('#list').append('</tr>');
		}
	}

	function load(){
		$('#list').empty();
		for(var i = 0; i < localStorage.length; ){
			$('#list').append('<tr>');
			for(var j = 0; j < 10/* ←列数 */ && i < localStorage.length; i++, j++){
				var _key = localStorage.key(i);
				$('#list:last').append('<td style="width:40px; text-align:right;">' + _key + '</td>');
			}
			$('#list').append('</tr>');
		}
	}
    
    </script>
    <div data-role="header">
        <h1>ビンゴカードID入力</h1>
        <a href ="canvas.html" rel="external">カード一覧</a>
         <a href ="about.html" rel="external" class="ui-btn-right" data-icon="info">About</a>
    </div>
  
    <div data-role="contents" class="ui-content">
            <p>ID：<input id="textkey1" size="5" type="number">
            <p>～ID：<input id="textkey2" size="5" type="number">
            値：<input id="textdata" type="text" /></p>
            <p align="left">
            <button  class="ui-btn" id="button" data-inline="true" onclick="setlocalStorage()">保存</button>
            <p>削除ID：<input id="deltextkey" type="number" data-inline="true">
            <button id="button" data-inline="true" onclick="removeStorage()">削除</button>
            <button id="button" data-inline="true" onclick="removeallStorage()">全て削除</button></p>
          <h4>入力履歴</h4>
          <table class="tagForList2">
          <thead>
		  <tr>
		  <th>ID</th>
		  </tr>
		  </thead>
		  <tbody id="list">
		  </tbody>
		  </table>
    </div>
    <div data-role="footer">
         <p>CopyRight:Fukushi-Lab.</p>
    </div>
  </div>  
 </body> 
</html>